<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-i18n="admin.dashboard.title">Admin Dashboard ‚Ä¢ H·ªìng Tr√† Ng√¥ Gia</title>
  <link rel="icon" type="image/png" href="assets/images/logo-divider.png">
</head>
<body>
  <div id="app-header"></div>
  <div class="admin-layout" id="adminLayout">
    <div class="main">
      <header class="topbar">
        <button class="export-btn" id="btnExportReport" type="button" data-i18n="admin.dashboard.exportReport">Xu·∫•t b√°o c√°o t·ªïng k·∫øt</button>
        <div class="top-actions">
          <div class="dropdown" id="ddUser">
            <button class="dd-btn" id="ddUserBtn" type="button" aria-haspopup="menu" aria-expanded="false" aria-controls="ddUserMenu"></button>
            <div class="dd-menu" id="ddUserMenu" role="menu" hidden></div>
          </div>
          <div class="dropdown" id="ddMore">
            <button class="dd-btn" id="ddMoreBtn" type="button" aria-haspopup="menu" aria-expanded="false" aria-controls="ddMoreMenu"></button>
            <div class="dd-menu" id="ddMoreMenu" role="menu" hidden></div>
          </div>
        </div>
      </header>

      <main class="content">
        <section class="cards" id="overview">
          <div class="card stat revenue">
            <div class="stat-title">
              <img src="assets/icons/doanhthu.png" alt="Revenue icon" style="width: 24px; height: 24px; margin-right: 8px; vertical-align: middle;">
              <span data-i18n="admin.dashboard.revenue">DOANH THU</span>
            </div>
            <div class="stat-value" id="sRevenue">679.000ƒë</div>
            <div class="stat-desc">
              <img src="/assets/icons/grow.png" alt="Bestseller icon" class="stat-desc-icon">
              <span data-i18n="admin.dashboard.last24h">Trong 24h qua</span> +36.6%
            </div>
          </div>
          
          <div class="card stat orders">
            <div class="stat-title">
              <img src="assets/icons/order.png" alt="Order icon" style="width: 24px; height: 24px; margin-right: 8px; vertical-align: middle;">
              <span data-i18n="admin.dashboard.ordersToday">ƒê∆†N H√ÄNG TU·∫¶N N√ÄY</span>
            </div>
            <div class="stat-value" id="sOrders">0</div>
            <div class="stat-desc">
              <img src="/assets/icons/grow.png" alt="Bestseller icon" class="stat-desc-icon">
              <span data-i18n="admin.dashboard.vsYesterday">So v·ªõi h√¥m qua:</span> <span id="sOrdersDelta">+65.4%</span>
            </div>
          </div>
          
          <div class="card stat bestseller">
            <div class="stat-title">
              <img src="assets/icons/bestseller.png" alt="Best seller icon" style="width: 24px; height: 24px; margin-right: 8px; vertical-align: middle;">
              <span data-i18n="admin.dashboard.productsSold">S·∫¢N PH·∫®M ƒê√É B√ÅN</span>
            </div>
            <div class="stat-value" id="sCustomers">327 S·∫¢N PH·∫®M</div>
            <div class="stat-desc">
              <img src="/assets/icons/grow.png" alt="Bestseller icon" class="stat-desc-icon">
              <span data-i18n="admin.dashboard.thisWeek">Tu·∫ßn n√†y</span>
            </div>
          </div>
          
          <div class="card stat products">
            <div class="stat-title">
              <img src="assets/icons/product.png" alt="Product icon" style="width: 24px; height: 24px; margin-right: 8px; vertical-align: middle;">
              <span data-i18n="admin.dashboard.products">S·∫¢N PH·∫®M</span>
            </div>
            <div class="stat-value" id="sProducts">0</div>
            <div class="stat-desc" data-i18n="admin.dashboard.inBusiness">ƒêang kinh doanh</div>
          </div>
        </section>

        <section class="grid2">
          <div class="card chart" id="reports">
            <div class="card-title" data-i18n="admin.dashboard.performance">Hi·ªáu su·∫•t (Doanh thu & Chi ph√≠)</div>
            <canvas id="revCostChart" height="260"></canvas>
          </div>

          <div class="card tasks" id="settings">
            <div class="card-title" data-i18n="admin.dashboard.topDrinks">Top th·ª©c u·ªëng b√°n ch·∫°y</div>
            <div class="chart-wrap">
              <canvas id="catPieChart" height="220"></canvas>
            </div>
          </div>
        </section>

        <section class="card table" id="orders">
          <div class="card-title" data-i18n="admin.dashboard.recentOrders">ƒê∆°n h√†ng g·∫ßn ƒë√¢y</div>
          <div class="table-scroll">         
            <table>
              <thead>
                <tr>
                  <th data-i18n="admin.dashboard.orderCode">M√£</th>
                  <th data-i18n="admin.dashboard.customer">Kh√°ch</th>
                  <th data-i18n="admin.dashboard.time">Th·ªùi Gian</th>
                  <th data-i18n="admin.dashboard.status">Tr·∫°ng th√°i</th>
                  <th data-i18n="admin.dashboard.total">T·ªïng</th>
                  <th data-i18n="admin.dashboard.actions">T√πy ch·ªânh</th>
                </tr>
              </thead>
              <tbody id="ordersBody">
              </tbody>
            </table>  
          </div>       
        </section>

        <section class="card table" id="products">
          <div class="card-header-block">
            <div class="card-title" data-i18n="admin.dashboard.products">S·∫£n ph·∫©m</div>
            <div class="card-actions-row">
              <button type="button" class="btn btn-add" id="btn-add-product">
                <span class="btn-icon">+</span>
                <span data-i18n="admin.dashboard.addProduct">Th√™m s·∫£n ph·∫©m</span>
              </button>
              
              <div class="search-box">
                <input type="search" id="product-search" data-i18n-placeholder="admin.dashboard.searchProduct" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..." aria-label="T√¨m ki·∫øm s·∫£n ph·∫©m">
                <button type="button" class="search-btn" aria-label="T√¨m ki·∫øm">
                  <img src="assets/icons/search.png" alt="Search">
                </button>
              </div>
              
              <div style="flex: 1;"></div>
              
              <select id="category-filter" class="category-filter" aria-label="L·ªçc theo danh m·ª•c">
                <option value="" data-i18n="admin.dashboard.allCategories">T·∫•t c·∫£ danh m·ª•c</option>
              </select>
            </div>
          </div>
          <div class="table-scroll">
            <table>
              <thead>
                <tr>
                  <th data-i18n="admin.dashboard.id">ID</th>
                  <th data-i18n="admin.dashboard.name">T√™n</th>
                  <th data-i18n="admin.dashboard.category">Danh m·ª•c</th>
                  <th data-i18n="admin.dashboard.image">H√¨nh ·∫£nh</th>
                  <th data-i18n="admin.dashboard.price">Gi√°</th>
                  <th data-i18n="admin.dashboard.actions">T√πy ch·ªânh</th>
                </tr>
              </thead>
              <tbody id="productsBody"></tbody>
            </table>
          </div>
          
          <div class="productsPager" id="productsPager"></div>
        </section>
      </main>
    </div>
  </div>

  <!-- Modal ch·ªânh s·ª≠a s·∫£n ph·∫©m - B·ªë c·ª•c gi·ªëng Th√™m s·∫£n ph·∫©m -->
<div id="modal-edit-product" class="modal" style="display:none;" role="dialog" aria-labelledby="edit-product-title" aria-modal="true">
  <div class="modal-overlay" data-close-modal></div>
  <div class="modal-container modal-add-product">
    <div class="modal-header">
      <h2 id="edit-product-title" class="modal-title">CH·ªàNH S·ª¨A S·∫¢N PH·∫®M</h2>
      <button type="button" class="modal-close" data-close-modal>&times;</button>
    </div>

    <form id="form-edit-product" class="modal-body">
      <!-- Row 1: T√™n s·∫£n ph·∫©m + Lo·∫°i -->
      <div class="form-row-equal">
        <div class="form-group">
          <label for="edit-product-name">T√™n s·∫£n ph·∫©m</label>
          <input 
            type="text" 
            id="edit-product-name" 
            placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m" 
            required
          >
        </div>
        
        <div class="form-group">
          <label for="edit-product-category">Lo·∫°i</label>
          <select id="edit-product-category" required>
            <option value="">Ch·ªçn lo·∫°i s·∫£n ph·∫©m</option>
          </select>
        </div>
      </div>

      <!-- Row 2: T√¨nh tr·∫°ng - Checkbox n·∫±m ngang b√™n ph·∫£i -->
      <div class="form-group-status">
        <label>T√¨nh tr·∫°ng</label>
        <div class="checkbox-group">
          <label>
            <input type="checkbox" id="edit-product-visible" checked>
            <span>Hi·ªÉn th·ªã s·∫£n ph·∫©m</span>
          </label>
          <label>
            <input type="checkbox" id="edit-product-special">
            <span>S·∫£n ph·∫©m c√≥ ∆∞u ƒë√£i ƒë·∫∑c bi·ªát</span>
          </label>
        </div>
      </div>

      <!-- Row 3: Gi√° hi·ªán t·∫°i + Gi√° VIP (2 c·ªôt) -->
      <div class="price-section">
        <div class="price-column">
          <div class="price-column-title">Gi√° hi·ªán t·∫°i</div>
          <div class="price-input-row">
            <input 
              type="text" 
              id="edit-price-m" 
              placeholder="0 VNƒê"
            >
            <span class="size-label">Size M</span>
          </div>
          <div class="price-input-row">
            <input 
              type="text" 
              id="edit-price-l" 
              placeholder="0 VNƒê"
            >
            <span class="size-label">Size L</span>
          </div>
        </div>

        <div class="price-column">
          <div class="price-column-title">Gi√° VIP</div>
          <div class="price-input-row">
            <input 
              type="text" 
              id="edit-vip-price-m" 
              placeholder="0 VNƒê"
            >
            <span class="size-label">Size M</span>
          </div>
          <div class="price-input-row">
            <input 
              type="text" 
              id="edit-vip-price-l" 
              placeholder="0 VNƒê"
            >
            <span class="size-label">Size L</span>
          </div>
        </div>
      </div>

      <!-- Row 4: Th√¥ng tin s·∫£n ph·∫©m -->
      <div class="form-group">
        <label for="edit-product-desc">Th√¥ng tin s·∫£n ph·∫©m</label>
        <textarea 
          id="edit-product-desc" 
          rows="4"
          placeholder="Nh·∫≠p th√¥ng tin s·∫£n ph·∫©m..."
        ></textarea>
      </div>

      <!-- Row 5: M√¥ t·∫£ s·∫£n ph·∫©m -->
      <div class="form-group">
        <label for="edit-product-detail">M√¥ t·∫£ s·∫£n ph·∫©m</label>
        <textarea 
          id="edit-product-detail" 
          rows="4"
          placeholder="Nh·∫≠p m√¥ t·∫£ s·∫£n ph·∫©m..."
        ></textarea>
      </div>

      <!-- Row 6: H√¨nh ·∫£nh -->
      <div class="image-upload-section">
        <label>H√¨nh ·∫£nh s·∫£n ph·∫©m</label>
        
        <input 
          type="file" 
          id="edit-product-image" 
          accept="image/*" 
          style="display:none;"
        >
        
        <!-- Click v√†o box ƒë·ªÉ upload -->
        <div class="image-preview-box" id="edit-image-preview-box">
          <div class="upload-placeholder" id="edit-upload-placeholder">
            <img 
              src="/assets/icons/upload.png" 
              alt="Upload" 
              class="upload-icon"
            >
            <span class="upload-text">T·∫£i ·∫£nh l√™n</span>
          </div>
          <img src="" alt="Preview" id="edit-preview-img" style="display:none;">
        </div>
      </div>
    </form>

    <div class="modal-footer">
      <button type="button" class="btn-danger" id="btn-delete-product">
        <span class="btn-icon"><img src="assets/icons/delete3.png" alt="" style="width:18px;height:18px;"></span>
        <span>X√≥a</span>
      </button>
      <button type="submit" form="form-edit-product" class="btn-primary">
        <span class="btn-icon"><img src="assets/icons/tick2.png" alt="" style="width:18px;height:18px;"></span>
        <span>L∆∞u</span>
      </button>
    </div>
  </div>
</div>

<!-- Modal x√°c nh·∫≠n x√≥a s·∫£n ph·∫©m -->
<div id="modal-delete-confirm" class="modal" style="display:none;" role="dialog" aria-labelledby="delete-title" aria-modal="true">
  <div class="modal-overlay" data-close-delete></div>
  <div class="modal-container modal-confirm">
    <button type="button" class="modal-close" data-close-delete aria-label="ƒê√≥ng">&times;</button>
    
    <div class="modal-body modal-confirm-body">
      <div class="modal-confirm-header">
        <div class="confirm-icon">
          <span class="icon-question">?</span>
        </div>
        <div class="confirm-text">
          <h2 id="delete-title" class="confirm-title">X√ÅC NH·∫¨N X√ìA S·∫¢N PH·∫®M</h2>
          <p class="confirm-message">Sau khi x√≥a, b·∫°n s·∫Ω kh√¥ng th·ªÉ kh√¥i ph·ª•c s·∫£n ph·∫©m.</p>
        </div>
      </div>
      
      <div class="confirm-actions">
        <button type="button" class="btn btn-cancel" data-close-delete>
          <img src="assets/icons/delete3.png" alt="" style="width:18px;height:18px;margin-right:6px;">
          H·ªßy b·ªè
        </button>
        <button type="button" class="btn btn-confirm" id="btn-confirm-delete">
          <img src="assets/icons/tick2.png" alt="" style="width:18px;height:18px;margin-right:6px;">
          Ti·∫øp t·ª•c
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal chi ti·∫øt ƒë∆°n h√†ng -->
<div id="modal-order-detail" class="modal" style="display:none;" role="dialog" aria-modal="true">
  <!--  data-close-order -->
  <div class="modal-overlay" data-close-order></div>
  <div class="modal-container modal-order-detail">
    <div class="modal-header-order">
      <h2 class="modal-title-order">CHI TI·∫æT ƒê∆†N H√ÄNG</h2>
      <!-- data-close-order -->
      <button type="button" class="modal-close" data-close-order aria-label="ƒê√≥ng">&times;</button>
    </div>

    <div class="modal-body-order">
      <!-- Th√¥ng tin ƒë∆°n h√†ng - Bao g·ªìm c·∫£ ƒë·ªãa ch·ªâ -->
      <div class="order-info-section">
        <div class="order-info-header">
          <img src="assets/icons/Cart.png" alt="Cart" class="section-icon">
          <h3 class="section-title">Th√¥ng tin ƒë∆°n h√†ng</h3>
        </div>
        <div class="order-info-grid">
          <div class="info-row">
            <span class="info-label">M√£ ƒë∆°n h√†ng:</span>
            <span class="info-value" id="order-id">HTNGTD273</span>
          </div>
          <div class="info-row">
            <span class="info-label">Ng√†y ƒë·∫∑t h√†ng:</span>
            <span class="info-value" id="order-date">20/10/2025</span>
          </div>
          <div class="info-row">
            <span class="info-label">Th·ªùi gian:</span>
            <span class="info-value" id="order-time">07:28 am</span>
          </div>
          <div class="info-row">
            <span class="info-label">T√¨nh tr·∫°ng ƒë∆°n h√†ng:</span>
            <div style="display: flex; gap: 12px; align-items: center;">
              <select id="order-status-dropdown" class="status-dropdown">
                <option value="pending">Ch·ªù x√°c nh·∫≠n</option>
                <option value="processing">ƒêang x·ª≠ l√Ω</option>
                <option value="completed">ƒê√£ giao h√†ng</option>
                <option value="cancelled">ƒê√£ h·ªßy</option>
              </select>
              <span class="info-value status-badge status-delivered" id="order-status-text">ƒê√£ giao h√†ng</span>
            </div>
          </div>
        </div>

        <!-- ƒê·ªãa ch·ªâ ng∆∞·ªùi nh·∫≠n - N·∫±m trong c√πng section -->
        <div class="order-info-divider"></div>
        <div class="order-info-subsection">
          <div class="subsection-header">
            <h4 class="subsection-title">ƒê·ªãa ch·ªâ ng∆∞·ªùi nh·∫≠n:</h4>
          </div>
          <div class="order-info-grid">
            <div class="info-row">
              <span class="info-label">H·ªç v√† t√™n:</span>
              <span class="info-value" id="customer-name">Nguy·ªÖn B√° D≈©</span>
            </div>
            <div class="info-row">
              <span class="info-label">S·ªë ƒëi·ªán tho·∫°i:</span>
              <span class="info-value" id="customer-phone">0934727978</span>
            </div>
            <div class="info-row full-width">
              <span class="info-label">ƒê·ªãa ch·ªâ:</span>
              <span class="info-value" id="customer-address">Bcons plaza, Th·ªëng Nh·∫•t, Dƒ© An B√¨nh D∆∞∆°ng</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Danh s√°ch ƒë∆°n h√†ng -->
      <div class="order-items-section">
        <div class="order-info-header">
          <img src="assets/icons/cart3.png" alt="List" class="section-icon">
          <h3 class="section-title">Danh s√°ch ƒë∆°n h√†ng</h3>
        </div>
        <div class="order-items-list" id="order-items">
          <!-- Item 1 -->
          <div class="order-item">
            <img src="assets/images/products/hong-tra-dai-loan.jpg" alt="Product" class="item-image">
            <div class="item-details">
              <h4 class="item-name">H·ªìng tr√† ƒë√†i loan</h4>
              <p class="item-specs">K√≠ch c·ª°: L, ƒê·ªô ng·ªçt: V·ª´a, 2x Th·∫°ch d·ª´a nguy√™n v·ªã</p>
            </div>
            <div class="item-price">25.000ƒë</div>
          </div>
          
          <!-- Item 2 -->
          <div class="order-item">
            <img src="assets/images/products/tra-sua-dai-loan.jpg" alt="Product" class="item-image">
            <div class="item-details">
              <h4 class="item-name">Tr√† s·ªØa ƒê√†i Loan</h4>
              <p class="item-specs">K√≠ch c·ª°: M, ƒê·ªô ng·ªçt: √çt, Tr√¢n ch√¢u ho√†ng kim, 2x pudding Trung</p>
            </div>
            <div class="item-price">40.000ƒë</div>
          </div>
        </div>
      </div>

      <!-- Th√¥ng tin thanh to√°n -->
      <div class="order-payment-section">
        <h3 class="payment-title">Th√¥ng tin thanh to√°n</h3>
        <div class="payment-row">
          <span class="payment-label">T·ªïng ti·ªÅn t·∫°m t√≠nh</span>
          <span class="payment-value" id="subtotal">65.000ƒë</span>
        </div>
        <div class="payment-row">
          <span class="payment-label">Ph√≠ v·∫≠n chuy·ªÉn</span>
          <span class="payment-value" id="shipping-fee">0ƒë</span>
        </div>
        <div class="payment-row">
          <span class="payment-label">M√£ gi·∫£m gi√°</span>
          <span class="payment-value" id="discount">0ƒë</span>
        </div>
        <div class="payment-row payment-total">
          <span class="payment-label-total">T·ªïng ti·ªÅn</span>
          <span class="payment-value-total" id="total-amount">65.000ƒë</span>
        </div>
      </div>
    </div>

    <!-- N√∫t L∆∞u -->
    <div class="modal-footer">
      <button type="button" class="btn-primary" id="btn-save-order">
        <span class="btn-icon"><img src="assets/icons/tick2.png" alt="" style="width:18px;height:18px;"></span>
        <span>L∆∞u</span>
      </button>
    </div>
  </div>
</div>

<!--  Modal th√™m s·∫£n ph·∫©m - B·ªë c·ª•c m·ªõi -->
<div id="modal-add-product" class="modal" style="display:none;" role="dialog" aria-modal="true">
  <div class="modal-overlay" data-close-add-modal></div>
  <div class="modal-container modal-add-product">
    <div class="modal-header">
      <h2 class="modal-title">TH√äM S·∫¢N PH·∫®M</h2>
      <button type="button" class="modal-close" data-close-add-modal>&times;</button>
    </div>

    <form id="form-add-product" class="modal-body">
      <!-- Row 1: T√™n s·∫£n ph·∫©m + Lo·∫°i -->
      <div class="form-row-equal">
        <div class="form-group">
          <label for="add-product-name">T√™n s·∫£n ph·∫©m</label>
          <input 
            type="text" 
            id="add-product-name" 
            placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m" 
            required
          >
        </div>
        
        <div class="form-group">
          <label for="add-product-category">Lo·∫°i</label>
          <select id="add-product-category" required>
            <option value="">Ch·ªçn lo·∫°i s·∫£n ph·∫©m</option>
          </select>
        </div>
      </div>

      <!-- Row 2: T√¨nh tr·∫°ng -->
      <div class="form-group-status">
        <label>T√¨nh tr·∫°ng</label>
        <div class="checkbox-group">
          <label>
            <input type="checkbox" id="add-product-visible" checked>
            <span>Hi·ªÉn th·ªã s·∫£n ph·∫©m</span>
          </label>
          <label>
            <input type="checkbox" id="add-product-special">
            <span>S·∫£n ph·∫©m c√≥ ∆∞u ƒë√£i ƒë·∫∑c bi·ªát</span>
          </label>
        </div>
      </div>

      <!-- Row 3: Gi√° hi·ªán t·∫°i + Gi√° VIP (2 c·ªôt) -->
      <div class="price-section">
        <div class="price-column">
          <div class="price-column-title">Gi√° hi·ªán t·∫°i</div>
          <div class="price-input-row">
            <input 
              type="text" 
              id="add-price-m" 
              placeholder="0 VNƒê"
            >
            <span class="size-label">Size M</span>
          </div>
          <div class="price-input-row">
            <input 
              type="text" 
              id="add-price-l" 
              placeholder="0 VNƒê"
            >
            <span class="size-label">Size L</span>
          </div>
        </div>

        <div class="price-column">
          <div class="price-column-title">Gi√° VIP</div>
          <div class="price-input-row">
            <input 
              type="text" 
              id="add-vip-price-m" 
              placeholder="0 VNƒê"
            >
            <span class="size-label">Size M</span>
          </div>
          <div class="price-input-row">
            <input 
              type="text" 
              id="add-vip-price-l" 
              placeholder="0 VNƒê"
            >
            <span class="size-label">Size L</span>
          </div>
        </div>
      </div>

      <!-- Row 4: Th√¥ng tin s·∫£n ph·∫©m -->
      <div class="form-group">
        <label for="add-product-desc">Th√¥ng tin s·∫£n ph·∫©m</label>
        <textarea 
          id="add-product-desc" 
          rows="4"
          placeholder="Nh·∫≠p th√¥ng tin s·∫£n ph·∫©m..."
        ></textarea>
      </div>

      <!-- Row 5: M√¥ t·∫£ s·∫£n ph·∫©m -->
      <div class="form-group">
        <label for="add-product-detail">M√¥ t·∫£ s·∫£n ph·∫©m</label>
        <textarea 
          id="add-product-detail" 
          rows="4"
          placeholder="Nh·∫≠p m√¥ t·∫£ s·∫£n ph·∫©m..."
        ></textarea>
      </div>

      <!-- Row 6: H√¨nh ·∫£nh -->
      <div class="image-upload-section">
        <label>H√¨nh ·∫£nh s·∫£n ph·∫©m</label>
        
        <input 
          type="file" 
          id="add-product-image" 
          accept="image/*" 
          style="display:none;"
        >
        
        <div class="image-preview-box" id="add-image-preview-box">
          <div class="upload-placeholder" id="upload-placeholder">
            <img 
              src="/assets/icons/upload.png" 
              alt="Upload" 
              class="upload-icon"
            >
            <span class="upload-text">T·∫£i ·∫£nh l√™n</span>
          </div>
          <img src="" alt="Preview" id="add-preview-img" style="display:none;">
        </div>
      </div>
    </form>

    <div class="modal-footer">
      <button type="button" class="btn-danger" data-close-add-modal>
        <span class="btn-icon"><img src="assets/icons/delete3.png" alt="" style="width:18px;height:18px;"></span>
        <span>H·ªßy b·ªè</span>
      </button>
      <button type="submit" form="form-add-product" class="btn-primary">
        <span class="btn-icon">+</span>
        <span>Th√™m</span>
      </button>
    </div>
  </div>
</div>


<div id="modal-success" class="modal modal-success" style="display:none;" role="dialog" aria-modal="true">
  <div class="modal-overlay"></div>
  <div class="modal-container modal-success-container">
    <div class="modal-success-content">
      <div class="success-icon">
        <img src="assets/icons/tick2.png" alt="Success" style="width:48px;height:48px;">
      </div>
      <h2 class="success-title" id="success-message">CH·ªàNH S·ª¨A TH√ÄNH C√îNG</h2>
      <button type="button" class="btn-close-success" id="btn-close-success">
        &times;
      </button>
    </div>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  
  <script ngNonBindable>
    window.reloadAdminTranslations = async function(lang) {
      try {
        const response = await fetch(`/public/lang/${lang}.json`);
        if (!response.ok) throw new Error('Failed to load translations');
        
        const translations = await response.json();
        
        document.querySelectorAll('[data-i18n]').forEach(el => {
          const key = el.getAttribute('data-i18n');
          if (translations[key]) {
            if (el.tagName === 'TITLE') {
              document.title = translations[key];
            } else if (el.tagName === 'INPUT' && el.type !== 'button') {
              el.placeholder = translations[key];
            } else if (el.tagName === 'OPTION') {
              el.textContent = translations[key];
            } else {
              el.textContent = translations[key];
            }
          }
        });
        
        document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
          const key = el.getAttribute('data-i18n-placeholder');
          if (translations[key]) {
            el.placeholder = translations[key];
          }
        });
        
        document.documentElement.lang = lang;
        window.adminTranslations = translations;
        
        console.log('‚úÖ Admin translations reloaded:', lang);
      } catch (error) {
        console.error('Failed to reload admin translations:', error);
      }
    };

    window.addEventListener('storage', function(e) {
      if (e.key === 'app.lang' && e.newValue) {
        console.log('üîÑ Language changed:', e.newValue);
        window.reloadAdminTranslations(e.newValue);
      }
    });

    document.addEventListener('DOMContentLoaded', function() {
      const savedLang = localStorage.getItem('app.lang') || 'vi';
      window.reloadAdminTranslations(savedLang);
    });
  </script>
  
  <script ngNonBindable>
    (function(){
      async function loadHeaderAdmin(){
        try{
          const el = document.getElementById('app-header');
          if(!el) return;
          const res = await fetch('/src/Components/page-header/header-admin.html', { cache: 'no-cache' });
          el.innerHTML = await res.text();
          
          // Setup user menu dropdown after header loaded
          setTimeout(() => {
            const userBtn = document.getElementById('user-btn');
            const userMenu = document.getElementById('user-menu');
            const userBox = document.getElementById('user-box');
            
            if (userBtn && userMenu) {
              // Close menu initially
              userMenu.setAttribute('hidden', '');
              userBtn.setAttribute('aria-expanded', 'false');
              
              // Toggle menu on button click
              userBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                const isExpanded = userBtn.getAttribute('aria-expanded') === 'true';
                userBtn.setAttribute('aria-expanded', String(!isExpanded));
                if (isExpanded) {
                  userMenu.setAttribute('hidden', '');
                } else {
                  userMenu.removeAttribute('hidden');
                }
              });
              
              // Close menu when clicking outside
              document.addEventListener('click', function(e) {
                if (userBox && !userBox.contains(e.target)) {
                  userBtn.setAttribute('aria-expanded', 'false');
                  userMenu.setAttribute('hidden', '');
                }
              });
              
              // Handle logout
              const btnLogout = document.getElementById('btn-logout');
              if (btnLogout) {
                btnLogout.addEventListener('click', function(e) {
                  e.preventDefault();
                  if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                    localStorage.removeItem('admin_token');
                    localStorage.removeItem('authAdmin');
                    localStorage.removeItem('authUser');
                    localStorage.removeItem('ngogia_user');
                    window.location.href = '/login-admin/';
                  }
                });
              }
            }
          }, 150);
        }catch(err){ console.error('Load admin header failed', err); }
      }
      if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', loadHeaderAdmin); else loadHeaderAdmin();
    })();
  </script>
  <script>
    (function(){
      function populateMonths(menu){
        if(!menu) return;
        menu.innerHTML='';
        const now=new Date();
        for(let i=0;i<12;i++){
          const d=new Date(now.getFullYear(), now.getMonth()-i, 1);
          const label=(d.getMonth()+1).toString().padStart(2,'0')+'/'+d.getFullYear();
          const val=d.toISOString().slice(0,7);
          const btn=document.createElement('button');
          btn.type='button'; btn.setAttribute('role','menuitem'); btn.dataset.value=val; btn.textContent=label;
          menu.appendChild(btn);
        }
      }
      function boot(){
        const ddUserBtn=document.getElementById('ddUserBtn');
        const ddUserMenu=document.getElementById('ddUserMenu');
        const ddMoreBtn=document.getElementById('ddMoreBtn');
        const ddMoreMenu=document.getElementById('ddMoreMenu');
        if(ddUserBtn && ddUserMenu){
          ddUserBtn.innerHTML='Chi nh√°nh: <strong id="branchLabel">T·∫•t c·∫£</strong> <span class="caret" aria-hidden="true">‚ñæ</span>';
          ddUserMenu.innerHTML='<button role="menuitem" data-branch="all" type="button">T·∫•t c·∫£</button>'+
            '<button role="menuitem" data-branch="1" type="button">ƒê∆∞·ªõng s·ªë 8 - H071</button>'+
            '<button role="menuitem" data-branch="2" type="button">Nguy·ªÖn An Ninh - H246</button>'+
            '<button role="menuitem" data-branch="3" type="button">L√Ω Th∆∞·ªùng Ki·ªát - H033</button>';
          const branchLabel=document.getElementById('branchLabel');
          const savedBranch=localStorage.getItem('admin_branch')||'all';
          const map={all:'T·∫•t c·∫£','1':'ƒê∆∞·ªõng s·ªë 8 - H071','2':'Nguy·ªÖn An Ninh - H246','3':'L√Ω Th∆∞·ªùng Ki·ªát - H033'};
          if(branchLabel) branchLabel.textContent=map[savedBranch]||'T·∫•t c·∫£';
          ddUserMenu.addEventListener('click', (e)=>{ const b=e.target.closest('button[role="menuitem"]'); if(!b) return; const val=b.dataset.branch; localStorage.setItem('admin_branch', val); if(branchLabel) branchLabel.textContent=map[val]||'T·∫•t c·∫£'; window.dispatchEvent(new CustomEvent('admin:filters',{detail:{branch:val}})); });
        }
        if(ddMoreBtn && ddMoreMenu){
          ddMoreBtn.innerHTML='Th√°ng: <strong id="monthLabel">Th√°ng n√†y</strong> <span class="caret" aria-hidden="true">‚ñæ</span>';
          populateMonths(ddMoreMenu);
          const monthLabel=document.getElementById('monthLabel');
          const savedMonth=localStorage.getItem('admin_month');
          if(savedMonth && monthLabel){ const [y,m]=savedMonth.split('-'); monthLabel.textContent=m+'/'+y; }
          ddMoreMenu.addEventListener('click', (e)=>{ const b=e.target.closest('button[role="menuitem"]'); if(!b) return; const val=b.dataset.value; localStorage.setItem('admin_month', val); const [y,m]=val.split('-'); if(monthLabel) monthLabel.textContent=m+'/'+y; window.dispatchEvent(new CustomEvent('admin:filters',{detail:{month:val}})); });
        }
      }
      if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', boot); else boot();
    })();
  </script>
  <script src="assets/Pages/Admin/admin.js" defer></script>
  
  <script ngNonBindable>
    (function(){
      function setup(btnId, menuId){
        const btn=document.getElementById(btnId); const menu=document.getElementById(menuId); const box=btn?.closest(".dropdown");
        if(!btn||!menu||!box) return;
        function open(){ menu.removeAttribute("hidden"); btn.setAttribute("aria-expanded","true"); box.classList.add("open"); }
        function close(){ menu.setAttribute("hidden",""); btn.setAttribute("aria-expanded","false"); box.classList.remove("open"); }
        btn.addEventListener("click",(e)=>{ e.stopPropagation(); (menu.hasAttribute("hidden")?open:close)(); });
        document.addEventListener("click",(e)=>{ if(!box.contains(e.target)) close(); });
        document.addEventListener("keydown",(e)=>{ if(e.key==="Escape") close(); });
      }
      const run=()=>{ setup("ddUserBtn","ddUserMenu"); setup("ddMoreBtn","ddMoreMenu"); };
      if(document.readyState==="loading") document.addEventListener("DOMContentLoaded", run); else run();
    })();
  </script>
  
  <script ngNonBindable>
    (function(){
      function toCSVRow(arr){ return arr.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(','); }
      function exportCSV(){
        const orders = document.getElementById('sOrders')?.textContent?.trim() || '';
        const revenue= document.getElementById('sRevenue')?.textContent?.trim() || '';
        const customers=document.getElementById('sCustomers')?.textContent?.trim() || '';
        const products =document.getElementById('sProducts')?.textContent?.trim() || '';
        const branch = localStorage.getItem('admin_branch') || 'all';
        const month  = localStorage.getItem('admin_month') || '';
        const now = new Date();
        const dateStr = now.toISOString().slice(0,10);
        const header = toCSVRow(['Ch·ªâ s·ªë','Gi√° tr·ªã']);
        const rows = [
          toCSVRow(['ƒê∆°n h√†ng h√¥m nay', orders]),
          toCSVRow(['Doanh thu', revenue]),
          toCSVRow(['Kh√°ch m·ªõi', customers]),
          toCSVRow(['S·∫£n ph·∫©m ƒëang b√°n', products]),
          toCSVRow(['Chi nh√°nh', branch]),
          toCSVRow(['K·ª≥ b√°o c√°o', month || dateStr]),
        ];
        const blob = new Blob([header+'\n'+rows.join('\n')], { type: 'text/csv;charset=utf-8;' });
        const a = document.createElement('a');
        const file = `bao-cao-tong-ket_${branch}_${(month||dateStr).replace(/[^0-9_-]/g,'')}.csv`;
        a.href = URL.createObjectURL(blob); a.download = file; a.style.display='none';
        document.body.appendChild(a); a.click(); setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 500);
      }
      const btn = document.getElementById('btnExportReport');
      if (btn) btn.addEventListener('click', exportCSV);
    })();
  </script>

  <!-- GI·ªÆ: Wait for header -->
  <script ngNonBindable>
    document.addEventListener('DOMContentLoaded', async function() {
      const savedLang = localStorage.getItem('app.lang') || 'vi';
      
      let attempts = 0;
      const waitForHeader = setInterval(() => {
        const headerElements = document.querySelectorAll('header [data-i18n]');
        
        if (headerElements.length > 0 || attempts > 20) {
          clearInterval(waitForHeader);
          console.log('‚úÖ Header ready, applying translations');
          window.reloadAdminTranslations(savedLang);
        }
        
        attempts++;
      }, 100);
      
      // ‚úÖ Handle hash navigation for products
      const handleProductsScroll = () => {
        const hash = window.location.hash.replace('#', '');
        if (hash === 'products' || hash === 'productsPager') {
          // Use requestAnimationFrame for immediate scroll
          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              const pager = document.getElementById('productsPager');
              if (pager) {
                console.log('üìç Scrolling to productsPager');
                const headerHeight = 100;
                const targetPosition = pager.offsetTop - headerHeight;
                window.scrollTo({
                  top: targetPosition,
                  behavior: 'smooth'
                });
              }
            });
          });
        }
      };
      
      // Run immediately after DOM ready
      handleProductsScroll();
      
      // ‚úÖ Listen for hash changes
      window.addEventListener('hashchange', handleProductsScroll);
    });
  </script>
</body>
</html>