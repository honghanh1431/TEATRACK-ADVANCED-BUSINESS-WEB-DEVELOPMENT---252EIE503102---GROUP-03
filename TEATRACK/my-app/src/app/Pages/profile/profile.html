<!-- Breadcrumb -->
<div class="account-breadcrumb">
  <div class="account-breadcrumb-container">
    <h2>Thông tin tài khoản</h2>
    <p>Trang chủ / Tài khoản</p>
  </div>
</div>

<main class="account-page">
  <div class="container account-layout">

    <!-- ── SIDEBAR ── -->
    <aside class="account-sidebar">
      <h3 class="sidebar-title">Tài khoản</h3>
      <nav class="sidebar-nav">
        <a class="nav-link" id="link-profile"
           [class.active]="activeTab === 'profile'"
           (click)="setTab('profile')">Thông tin cá nhân</a>
        <a class="nav-link" id="link-security"
           [class.active]="activeTab === 'security'"
           (click)="setTab('security')">Tài khoản &amp; bảo mật</a>
        <a class="nav-link" id="link-policy"
           [class.active]="activeTab === 'policy'"
           (click)="setTab('policy')">Chính sách &amp; điều khoản</a>
        <a class="nav-link" id="link-support"
           [class.active]="activeTab === 'support'"
           (click)="setTab('support')">Trung tâm trợ giúp</a>
        <a class="nav-link danger" (click)="logout()">Đăng xuất</a>
      </nav>
    </aside>

    <!-- ══════════════════════════════════════
         TAB: THÔNG TIN CÁ NHÂN
    ══════════════════════════════════════ -->
    <section class="account-content" id="account-content" *ngIf="activeTab === 'profile'">
      <header class="block-header">
        <h3>Thông tin cá nhân</h3>
      </header>

      <!-- Block: Cơ bản -->
      <div class="account-block">
        <h4 class="block-title">Thông tin cơ bản</h4>

        <div class="avatar-row">
          <div class="avatar-label">Hình ảnh:</div>
          <div class="avatar">
            <img id="avatarPreview" [src]="avatarSrc" alt="Ảnh đại diện">
            <input id="avatarInput" type="file" accept="image/*" hidden (change)="onAvatarChange($event)">
          </div>
          <div class="avatar-actions">
            <button type="button" class="btn btn-text" (click)="uploadAvatar()">Tải lên ảnh đại diện mới</button>
            <button type="button" class="btn btn-text danger" (click)="removeAvatar()">Gỡ ảnh đại diện</button>
          </div>
        </div>

        <div class="kv-table">
          <div class="kv-row">
            <div class="kv-label">Họ và tên:</div>
            <div class="kv-value">
              <input class="input-plain" id="fullName" [(ngModel)]="user.fullName" [readonly]="!isEditing">
            </div>
          </div>
          <div class="kv-row">
            <div class="kv-label">Ngày sinh:</div>
            <div class="kv-value">
              <input class="input-plain" id="dob" [(ngModel)]="user.dob" [readonly]="!isEditing">
            </div>
          </div>
          <div class="kv-row">
            <div class="kv-label">Giới tính:</div>
            <div class="kv-value">
              <input class="input-plain" id="gender" [(ngModel)]="user.gender" [readonly]="!isEditing">
            </div>
          </div>
        </div>
      </div>

      <!-- Block: Thông tin tài khoản -->
      <div class="account-block">
        <h4 class="block-title">Thông tin tài khoản</h4>

        <div class="kv-table">
          <div class="kv-row">
            <div class="kv-label">Email:</div>
            <div class="kv-value">
              <input class="input-plain" id="email" [(ngModel)]="user.email" [readonly]="!isEditing">
            </div>
          </div>
          <div class="kv-row">
            <div class="kv-label">Số điện thoại:</div>
            <div class="kv-value">
              <input class="input-plain" id="phone" [(ngModel)]="user.phone" [readonly]="!isEditing">
            </div>
          </div>
          <div class="kv-row">
            <div class="kv-label">Địa chỉ giao hàng:</div>
            <div class="kv-value">
              <input class="input-plain" id="address" [(ngModel)]="user.address" [readonly]="!isEditing">
            </div>
          </div>
        </div>

        <div class="actions">
          <button class="btn btn-primary" *ngIf="!isEditing" (click)="startEdit()">Chỉnh sửa thông tin</button>
          <button class="btn btn-primary" *ngIf="isEditing"  (click)="saveProfile()">Lưu thay đổi</button>
          <button class="btn btn-outline" *ngIf="isEditing"  (click)="cancelEdit()">Hủy</button>
        </div>
      </div>
    </section>

    <!-- ══════════════════════════════════════
         TAB: TÀI KHOẢN & BẢO MẬT
    ══════════════════════════════════════ -->
    <section class="account-content" id="account-content2" *ngIf="activeTab === 'security'">
      <header class="block-header">
        <h3>Tài khoản và bảo mật</h3>
      </header>

      <div class="account-block">
        <div class="kv-table">
          <div class="kv-row">
            <div class="kv-label">Tên đăng nhập:</div>
            <div class="kv-value">
              <input id="pf-username" class="input-plain" [value]="username" readonly>
            </div>
          </div>
          <div class="kv-row">
            <div class="kv-label">Mật khẩu:</div>
            <div class="kv-value">
              <input id="pf-password" class="input-plain" [value]="password" readonly>
            </div>
          </div>
          <div class="kv-row">
            <div class="kv-label">Tình trạng:</div>
            <div class="kv-value">
              <input id="pf-status" class="input-plain" [value]="status" readonly>
            </div>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-primary" *ngIf="!isEditingSecurity" (click)="isEditingSecurity = true">Chỉnh sửa thông tin</button>
        <button class="btn btn-primary" *ngIf="isEditingSecurity"  (click)="isEditingSecurity = false">Lưu thay đổi</button>
        <button class="btn btn-outline" *ngIf="isEditingSecurity"  (click)="isEditingSecurity = false">Hủy</button>
      </div>
    </section>

    <!-- ══════════════════════════════════════
         TAB: CHÍNH SÁCH & ĐIỀU KHOẢN
    ══════════════════════════════════════ -->
    <section class="account-policy" id="account-policy" *ngIf="activeTab === 'policy'">

      <div class="policy-header">
        <div class="policy-icon">
          <img src="assets/icons/policy.png" alt="Chính sách" class="policy-icon-img">
        </div>
        <div class="policy-title-line">
          <span class="line"></span>
          <h2 class="policy-main-title">Chính sách</h2>
          <span class="line"></span>
        </div>
      </div>

      <div class="policy-card">
        <div class="policy-section">
          <h3 class="policy-subtitle">a. Chính sách đặt hàng &amp; thanh toán</h3>
          <ul>
            <li>Khách hàng có thể đặt trực tiếp tại quán, qua hotline hoặc qua website chính thức của Hồng Trà Ngô Gia.</li>
            <li>Giá niêm yết là giá tại thời điểm đặt hàng, bao gồm thuế VAT (nếu có).</li>
            <li>Thanh toán có thể bằng tiền mặt, mã QR, hoặc ví điện tử.</li>
          </ul>
        </div>
        <div class="policy-section">
          <h3 class="policy-subtitle">b. Chính sách đổi trả – hoàn tiền</h3>
          <ul>
            <li>Sản phẩm là đồ uống tươi nên không áp dụng đổi trả sau khi giao hàng trừ trường hợp lỗi của nhà cung cấp.</li>
            <li>Trường hợp đơn hàng sai, hư hỏng hoặc chất lượng không đảm bảo, khách liên hệ hotline để được hỗ trợ đổi hoặc hoàn tiền trong vòng 24h.</li>
          </ul>
        </div>
        <div class="policy-section">
          <h3 class="policy-subtitle">c. Chính sách bảo mật thông tin khách hàng</h3>
          <ul>
            <li>Mọi thông tin cá nhân (số điện thoại, địa chỉ, lịch sử đặt hàng) được bảo mật và chỉ dùng để phục vụ chăm sóc khách hàng.</li>
            <li>Ngô Gia không chia sẻ dữ liệu cho bên thứ ba khi chưa có sự đồng ý của khách hàng.</li>
          </ul>
        </div>
        <div class="policy-section">
          <h3 class="policy-subtitle">d. Chính sách khuyến mãi &amp; tích điểm</h3>
          <ul>
            <li>Mỗi chương trình khuyến mãi có điều kiện riêng (hóa đơn tối thiểu, thời gian áp dụng...).</li>
            <li>Điểm thành viên hoặc ưu đãi khác được quy định theo chính sách tại từng thời kỳ.</li>
          </ul>
        </div>
      </div>

      <!-- ĐIỀU KHOẢN -->
      <div class="policy-header policy-header-terms">
        <div class="policy-title-line">
          <span class="line"></span>
          <h2 class="policy-main-title">Điều khoản</h2>
          <span class="line"></span>
        </div>
      </div>

      <div class="policy-card">
        <div class="policy-section">
          <h3 class="policy-subtitle">a. Điều khoản sử dụng</h3>
          <ul>
            <li>Khách hàng đồng ý tuân thủ quy định và chính sách của Hồng Trà Ngô Gia khi sử dụng dịch vụ.</li>
            <li>Cửa hàng có quyền từ chối phục vụ nếu khách hàng có hành vi vi phạm nội quy hoặc gây rối.</li>
            <li>Chương trình khuyến mãi không được quy đổi thành tiền mặt trừ khi có quy định riêng.</li>
          </ul>
        </div>
        <div class="policy-section">
          <h3 class="policy-subtitle">b. Điều khoản bổ sung</h3>
          <ul>
            <li>Hồng Trà Ngô Gia có thể cập nhật, thay đổi hoặc bổ sung điều khoản theo từng giai đoạn phát triển.</li>
            <li>Mọi thay đổi sẽ được công khai trên kênh chính thức; tiếp tục sử dụng dịch vụ sau khi cập nhật được xem là đồng ý với thay đổi đó.</li>
          </ul>
        </div>
      </div>

    </section>

    <!-- ══════════════════════════════════════
         TAB: TRUNG TÂM TRỢ GIÚP
    ══════════════════════════════════════ -->
    <section class="support-section" id="support-section" *ngIf="activeTab === 'support'">

      <div class="support-hero">
        <div class="support-hero-inner">
          <h2 class="support-hero-title">
            Xin chào <span>{{ user.fullName || 'Bạn' }}</span>,<br>
            Hồng trà Ngô gia giúp được gì cho bạn?
          </h2>
          <form class="searchbar" (submit)="$event.preventDefault()">
            <button class="searchbar__menu" type="button" aria-label="Mở menu">
              <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                <path d="M3 6h18M3 12h18M3 18h18"
                      fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
            <input id="q" name="q" type="search"
                   placeholder="Bạn có đang gặp khó khăn gì không nè?"
                   autocomplete="off" aria-label="Tìm kiếm"/>
            <button class="searchbar__submit" type="submit" aria-label="Tìm">
              <img src="assets/icons/search.png" alt="Tìm" width="32" height="32">
            </button>
          </form>
        </div>
      </div>

      <div class="support-card wrapper-card" role="region" aria-label="Liên hệ hỗ trợ">
        <h3 class="support-card-title">Liên hệ hỗ trợ</h3>
        <div class="support-contacts">
          <div class="contact-item" *ngFor="let c of contacts">
            <div class="contact-icon-wrap">
              <img [src]="c.icon" [alt]="c.label" class="contact-icon">
            </div>
            <div class="contact-body">
              <a [href]="c.href" target="_blank" rel="noopener">{{ c.display }}</a>
              <div class="contact-divider"></div>
            </div>
          </div>
          <!-- giữ grid cân bằng nếu lẻ -->
          <div class="contact-item contact-empty" aria-hidden="true" *ngIf="contacts.length % 2 !== 0"></div>
        </div>
      </div>

    </section>

  </div>
</main>